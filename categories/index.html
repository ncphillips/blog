<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Forestry.io Blog</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://forestry.io/docs/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link rel="icon" type="image/png" href="https://forestry.io/docs/images/favicon.png-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="https://forestry.io/docs/images/favicon-16x16.png" sizes="16x16" />
  <link rel="stylesheet" href="https://yui-s.yahooapis.com/pure/0.6.0/pure-min.css">
  
  
  <link rel="stylesheet" href="https://yui-s.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
  
  <link rel="stylesheet" href="https://forestry.io/blog//css/main.css">
  <script src="https://use.fonticons.com/b6f38602.js"></script>

  
  <link href="https://forestry.io/blog/categories/index.xml" rel="alternate" type="application/rss+xml" title="Forestry Blog" />
  <link href="https://forestry.io/blog/categories/index.xml" rel="feed" type="application/rss+xml" title="Forestry Blog" />
  

  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@forestryio">
  <meta name="twitter:creator" content="@scottgallant">
  <meta name="twitter:title" content="">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="https://forestry.io/blog/">

  
  <meta property="og:url" content="https://forestry.io/blog/categories/" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="" />
  <meta property="og:description" content="" />
  <meta property="og:image" content="https://forestry.io/blog/" />
  <meta property="fb:app_id" content="1628812937372396" />

</head>
<body>

<header class="site-header">
  <div class="container">
    <h1 class="logo"><a href="https://forestry.io">Forestry.io</a></h1>
    <nav class="main-nav">
      <ul id="menu">
        <li><a href="https://forestry.io/plans">Pricing</a></li>
        <li><a href="https://forestry.io/docs/">Docs</a></li>
        <li class="current"><a href="https://forestry.io/blog/">Blog</a></li>
        <li><a href="https://forestry.io/login">Login</a></li>
        <li><a href="https://forestry.io/signup">Sign up</a></li>
      </ul>
    </nav>
  </div>
</header>

<nav class="breadcrumbs">
	<div class="container">
		<ul>
			<li><a href="https://forestry.io/blog/">Docs</a> <span class="icon icon-chevron-right"></span></li>
			
			
			<li><a href="https://forestry.io/blog/categories/"></a> <span class="icon icon-chevron-right"></span></li>
		</ul>
		<div class="search-box search-box-sm">
			<form action="">
				<input type="text" class="search">
				<span class="icon icon-search"></span>
			</form>
		</div>
	</div>
</nav>

<div class="container pure-g">
	

	<div class="pure-u-1 pure-u-md-3-4 main-column">
		<div class="content">
		
			<div class="expanding-faq">
				<h2><a href="https://forestry.io/blog/post/march-27th-service-outage/">March 27th Service Outage<span class="icon icon-chevron-down"></span></a></h2>
				<div class="answer"><p>As some of you may have noticed, Forestry was down for about 2.5 hours between 23:00 UTC March 27 until 01:30 UTC March 28. In the spirit of full disclosure I&rsquo;d like to explain what happened and why.</p>

<p>Forestry is a Rails application and from time to time the number of migrations we have get unwieldy. Being an application under rapid development, things are constantly changing and migrations are created sometimes daily. To keep this every growing list of files at bay we use a tool called 
<a href="https://github.com/jalkoby/squasher" style="font-size: 1rem; background-color: rgb(255, 255, 255);">squasher</a>
<span style="font-size: 1rem;">&nbsp;to squash our migrations into a single migration.</span></p>

<p>The way squasher works is by taking the current state of the database and adding it to a migration with a filename that reflects the most recent migration that has run. This prevents the squashed migration from running when the database is migrated. This migration shouldn&rsquo;t run because, as it turns out, it will delete your entire database. The create_table statements are suffixed with <code>force: :cascade</code> which drops the table and all the related tables then recreates them. I think you can see where I am going.</p>

<p>I ran squasher on our migrations in dry run mode (as I have done before) to ensure that everything looked ok. Dry run mode creates the new squashed migration so that it can be inspected. My mistake was that I forgot to delete the migration that the dry run created before I ran it for real. On the subsequent run squasher picked up on the new migration, which didn&rsquo;t have a record in the database because it had never been run. The new squashed migration now had a name that did not exist in our production database and so when it ran, wiped our entire production database clean. The migration was run in development, but it was on a clean database so the issue wasn&rsquo;t noticed. And frankly, I wasn&rsquo;t worried because &ldquo;I&rsquo;ve done this before&rdquo;.</p>

<p>But&hellip; this is why we have backups. Our production database runs on 
<a href="https://aws.amazon.com/rds/" style="font-size: 1rem; background-color: rgb(255, 255, 255);">Amazon&nbsp;RDS</a>
<span style="font-size: 1rem;">&nbsp;in a multi-az deployment. By the time the issue was noticed, the changes had already propagated to the failover instance so we had to go back to a point-in-time restore. So we took the site offline and searched our logs to find the most recent successful API request (this was the longest part). Once we found that, it was just a few clicks (and some waiting) to get a restored copy of the database back up and running. All in all, we lost &lt; 1min worth of data.</span></p>

<p>Once service was restored, we had a backlog jobs that needed to be processed. You may have experienced slow publish/preview/import times while we churned through them. After about 30 mins of Forestry coming back online everything was back to normal.</p>

<p>TLDR; Accidentally deleted our production database by way of a bad migration so we had to restore from a backup.</p>

<p><span style="font-size: .8em;"><em>Thanks to
<a href="https://thenounproject.com/rockicon/">Rockicon</a> for the great DB icon on this post!</em></span></p>
</div>
			</div>
	  
			<div class="expanding-faq">
				<h2><a href="https://forestry.io/blog/post/what-s-new-in-jekyll-3-4-0/">What&#39;s new in Jekyll 3.4.0<span class="icon icon-chevron-down"></span></a></h2>
				<div class="answer">

<p>Jekyll 3.4.0 was release on the 27th of January 2017 with some noteworthy enhancements that I&rsquo;d like to share with you.</p>

<p>So what&rsquo;s new?</p>

<h2 id="add-connector-param-to-array-to-sentence-string-filter">Add connector param to ‘array_to_sentence_string’ filter</h2>

<ul>
<li><strong>array</strong> - The list of strings to join.</li>
<li><strong>string</strong> - A string can be any text inside quotes. In this example I will use Jekyll tags.</li>
<li><strong>connector</strong> - The word placed before the last word in the array. The default connector Jekyll uses is the word “and”.</li>
</ul>

<p>Still with me?</p>

<p>Here is a real world example. Our post has the following tags.</p>

<pre><code>tags:
	- one
	- two
	- three
</code></pre>

<p>We can then create an <code>_include</code> file for our post tags using</p>

<pre><code>{{ page.tags | array_to_sentence_string }}
</code></pre>

<p>This will output our tags</p>

<pre><code>one, two, and three
</code></pre>

<p>Easy right?</p>

<p>Now Jekyll 3.4.0 allows you to change the default connector to use other terms such as &ldquo;or” like so.</p>

<pre><code>{{ page.tags | array_to_sentence_string: 'or' }}
</code></pre>

<p>This will output</p>

<pre><code>one, two, or three
</code></pre>

<h2 id="group-an-array-s-items-using-a-liquid-expression-filter">Group an array&rsquo;s items using a Liquid expression filter</h2>

<p>Jekyll previously allowed you to group your content by a given property using the <code>group_by</code> filter. As an example let’s group all site members working for each company.</p>

<p>Our Jekyll site’s <code>_config.yml</code> includes the following members.</p>

<pre><code>members:
- name: &quot;Scott&quot;
  company: &quot;Forestry&quot;
- name: &quot;Jordan&quot;
  company: &quot;Forestry&quot;
- name: &quot;Parker&quot;
  company: &quot;Github&quot;
</code></pre>

<p>Jekyll can apply the <code>group_by</code> filter with company as the parameter using</p>

<pre><code>{{ site.members | group_by:&quot;company&quot; }}
</code></pre>

<p>Site members names are collected into an array which outputs the following information</p>

<pre><code>{“name”=&gt;”Forestry”, “items”=&gt;[{“name”=&gt;”Scott”, “company”=&gt;”Forestry”}, {“name”=&gt;”Jordan”, “company”=&gt;”Forestry”}], “size”=&gt;2}{“name”=&gt;”Github”, “items”=&gt;[{“name”=&gt;”Parker”, “company”=&gt;”Github”}], “size”=&gt;1}
</code></pre>

<p>To make this information more useful, we can now create a list of members grouped by their company name</p>

<pre><code>{% assign groups = site.members | group_by: &quot;company&quot; %}
{% for group in groups %}
    &lt;h3&gt;{{ group.name }}&lt;/h3&gt;
    &lt;ul&gt;
    {% for item in group.items %}
        &lt;li&gt;{{item.name}}&lt;/li&gt;
    {%endfor%}
    &lt;/ul&gt;
{%endfor%}
</code></pre>

<p>This will output the following list of site members organised by the company they work for.</p>

<pre><code>&lt;h3&gt;Forestry&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Scott&lt;/li&gt;
  &lt;li&gt;Jordan&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Github&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Parker&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>Jekyll 3.4.0 introduced the <code>group_by_exp</code> filter which allows you to group an array of items using a Liquid expression.</p>

<p>Now, we have the following data about our company software.</p>

<pre><code>
software:
- name: &quot;New shiny software&quot;
  version: &quot;0.4&quot;
- name: &quot;ABC software&quot;
  version: &quot;1.2&quot;
- name: &quot;XYZ software&quot;
  version: &quot;1.9&quot;
</code></pre>

<p>We can apply the <code>group_by_exp</code> filter to group our software by <em>major</em> version number.  For major version we are not concerned with the decimal places (just 1.x, 2.x, 3.x, etc).  So our expression will use the <strong>slice</strong> filter. Like so:</p>

<pre><code>{{ page.software | group_by_exp:&quot;item&quot;, &quot;item.version | slice: 0&quot; }}
</code></pre>

<p>This outputs the following information</p>

<pre><code>{“name”=&gt;”0”, “items”=&gt;[{“name”=&gt;”New shiny software”, “version”=&gt;”0.4”}], “size”=&gt;1}{“name”=&gt;”1”, “items”=&gt;[{“name”=&gt;”ABC software”, “version”=&gt;”1.2”}, {“name”=&gt;”XYZ software”, “version”=&gt;”1.9”}], “size”=&gt;2}
</code></pre>

<p>We will group our software by version</p>

<pre><code>{% assign groups = page.software | group_by_exp:&quot;item&quot;, &quot;item.version | slice: 0&quot; %}
{% for group in groups %}
    &lt;h3&gt;Major version number {{ group.name }}&lt;/h3&gt;

    &lt;ul&gt;
    {% for item in group.items %}
        &lt;li&gt;{{item.name}}&lt;/li&gt;
    {%endfor%}
    &lt;/ul&gt;
{%endfor%}
</code></pre>

<p>This gives us the following output</p>

<pre><code>&lt;h3&gt;Major version number 0&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;New shiny software&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;Major version number 1&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ABC software&lt;/li&gt;
  &lt;li&gt;XYZ software&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>In conclusion we can also use the <code>group_by_exp</code> filter to output different information such as site members names by changing the Liquid expression.</p>

<pre><code>{{ site.members | group_by_exp:&quot;item&quot;, &quot;item.name&quot; }}
</code></pre>

<p>This will output</p>

<pre><code>{&quot;name&quot;=&gt;&quot;Scott&quot;, &quot;items&quot;=&gt;[{&quot;name&quot;=&gt;&quot;Scott&quot;, &quot;company&quot;=&gt;&quot;Forestry&quot;, &quot;age&quot;=&gt;&quot;32&quot;}], &quot;size&quot;=&gt;1}{&quot;name&quot;=&gt;&quot;Jordan&quot;, &quot;items&quot;=&gt;[{&quot;name&quot;=&gt;&quot;Jordan&quot;, &quot;company&quot;=&gt;&quot;Forestry&quot;, &quot;age&quot;=&gt;&quot;33&quot;}], &quot;size&quot;=&gt;1}{&quot;name&quot;=&gt;&quot;Parker&quot;, &quot;items&quot;=&gt;[{&quot;name&quot;=&gt;&quot;Parker&quot;, &quot;company&quot;=&gt;&quot;Github&quot;, &quot;age&quot;=&gt;&quot;31&quot;}], &quot;size&quot;=&gt;1}
</code></pre>

<p>We can create a list of site members names like so</p>

<pre><code>{% assign groups = site.members | group_by_exp: &quot;item&quot;, &quot;item.name&quot; %}
{% for group in groups %}
    &lt;h3&gt;{{ group.name }}&lt;/h3&gt;
{%endfor%}
</code></pre>

<p>Output:</p>

<pre><code>&lt;h3&gt;Scott&lt;/h3&gt;
&lt;h3&gt;Jordan&lt;/h3&gt;
&lt;h3&gt;Parker&lt;/h3&gt;
</code></pre>

<h2 id="documentation-updates">Documentation updates</h2>

<ul>
<li><p>Jekyll’s plugin page now showcases the most <a href="http://jekyllrb.com/docs/plugins/#available-plugins/">popular plugins</a> .</p></li>

<li><p>The quick-start guide was updated so there’s never been a better time to <a href="https://jekyllrb.com/">try Jekyll</a>.</p></li>
</ul>

<h2 id="jekyll-warnings">Jekyll warnings</h2>

<ul>
<li><p>Jekyll now notifies you when you have an error in an <code>_include</code> file. This should save you some time tracking down bugs.</p></li>

<li><p>Jekyll now prevents double forward slash errors. In this case Jekyll will not append a forward slash to <code>url:</code> because the <code>baseurl:</code> input already contains ‘/‘.</p></li>
</ul>

<pre><code>url: &quot;http://example.com&quot;
baseurl: &quot;/blog&quot;
</code></pre>

<ul>
<li>Jekyll docs recommend ruby version 2.0 or above. If you have updated to ruby 2.4.0 you may have noticed the warnings “Bignum is deprecated” and “Fixnum is deprecated”. These warning come from the activesupport gem which is a Jekyll dependancy and will be fixed in an upcoming release. For now you can just ignore those warnings. You haven&rsquo;t done anything wrong.</li>
</ul>

<p>Let me know if you found these tutorials helpful.</p>
</div>
			</div>
	  
		</div>
	</div>
</div>
<footer class="site-footer">
<p>forestry.io, the CMS for static sites</p>
<p><a href="#">Terms of service</a> &bull; <a href="#">Privacy policy</a></p>
<p>
  <a href="https://forestry.io/blog/admin/"><span class="icon icon-key"></span> Edit</a>
</p>
</footer>

<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="https://forestry.io/blog//js/main.min.js"></script>
<script id="dsq-count-scr" src="//forestry-io.disqus.com/count.js" async></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39666952-5', 'auto');
  ga('send', 'pageview');

</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1628812937372396',
      xfbml      : true,
      version    : 'v2.7'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57b123938427fbd8"></script>
</body>
</html>

